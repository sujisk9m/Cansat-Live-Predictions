<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>OCEAN CANSAT MONITOR</title>

  <!-- load external css file -->
  <link rel="stylesheet" href="sty.css">
  <!-- jsPDF for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-logo">
        <span class="logo-icon">ðŸŒŠ</span>
        <span class="logo-text">OCEAN CANSAT MONITOR</span>
      </div>
      <ul class="nav-menu" id="navMenu">
        <li class="nav-item"><a href="#dashboard" class="nav-link active">Dashboard</a></li>
        <li class="nav-item"><a href="#simulation" class="nav-link">Simulation</a></li>
        <li class="nav-item"><a href="#analytics" class="nav-link">Analytics</a></li>
      </ul>
      <div class="nav-toggle" id="navToggle">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
      </div>
    </div>
  </nav>

  <!-- Dashboard Page -->
  <div class="wrap page-content" id="dashboard-page">
    <!-- First Row: Speed Indicator, Parameter Overview, 3D Simulation -->
    <div class="row first-row">
      <!-- Speed Indicator -->
      <div class="card speed-card">
        <div style="display:flex; justify-content:space-between; align-items:center">
          <div>
            <div class="small">SPEED INDICATOR</div>
            <div id="speedVal" style="font-size:18px; font-weight:700; color:var(--accent2)">0%</div>
          </div>
          <div id="leakPill" class="status-pill">Last: NO</div>
        </div>

        <div style="display:flex; gap:8px; margin-top:10px; align-items:center;">
          <div class="speed-gauge-wrap">
            <canvas id="speedGauge"></canvas>
          </div>

          <div style="flex:1; display:flex; flex-direction:column; gap:8px;">
            <div class="param-row">
              <div class="small">Energy (mV)</div><div id="energyNow" style="font-weight:700">--</div>
            </div>
            <div class="param-row">
              <div class="small">pH</div><div id="phNow" style="font-weight:700">--</div>
            </div>
            <div class="param-row">
              <div class="small">Pressure</div><div id="pressNow" style="font-weight:700">--</div>
            </div>
            <div class="param-row">
              <div class="small">Salinity</div><div id="salNow" style="font-weight:700">--</div>
            </div>
            <div class="param-row">
              <div class="small">Turbidity</div><div id="turbNow" style="font-weight:700">--</div>
            </div>
            <div class="param-row">
              <div class="small">Load</div><div id="loadNow" style="font-weight:700">--</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Parameter Overview -->
      <div class="card param-overview-card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div class="small">PARAMETER OVERVIEW</div>
        </div>

        <div class="param-overview-content" style="margin-top:10px;">
          <div class="param-row"><div class="small">pH</div><div class="ov-value" id="ovPH">--</div></div>
          <div class="param-row"><div class="small">Salinity</div><div class="ov-value" id="ovSal">--</div></div>
          <div class="param-row"><div class="small">Pressure</div><div class="ov-value" id="ovPress">--</div></div>
          <div class="param-row"><div class="small">Load</div><div class="ov-value" id="ovLoad">--</div></div>
        </div>
      </div>

      <!-- 3D Simulation -->
      <div class="card sim-card">
        <div style="width:100%;">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
            <div class="small">3D SIMULATION</div>
            <div class="small">Depth: <span id="depthNow">--</span></div>
          </div>

          <div class="sim-wrap" aria-hidden="false">
            <div class="cansat-glow" aria-hidden="true"></div>
            <img src="cansat.jpg" id="cansatImg" class="cansat-img cansat-anim" alt="CANSAT Underwater">
            <div class="shimmer" aria-hidden="true"></div>
            <div class="bubble-layer" aria-hidden="true">
              <div class="bubble xs b1" style="left:10%; animation-duration:9s;"></div>
              <div class="bubble sm b2" style="left:25%; animation-duration:12s;"></div>
              <div class="bubble lg b3" style="left:42%; animation-duration:8s;"></div>
              <div class="bubble sm b4" style="left:58%; animation-duration:13s;"></div>
              <div class="bubble xs b5" style="left:72%; animation-duration:10s;"></div>
              <div class="bubble sm b6" style="left:86%; animation-duration:7s;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Second Row: Trend Charts and Recent Records -->
    <div class="row second-row">
      <!-- Trend Charts -->
      <div class="card trend-card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div class="small">TREND CHARTS</div>
          <div class="small">Load: <span id="loadDisplay">100 ccm</span></div>
        </div>

        <div class="trend-grid" style="margin-top:10px;">
          <div class="trend-card-item">
            <div class="trend-title">pH level</div>
            <canvas id="phTrend"></canvas>
          </div>

          <div class="trend-card-item">
            <div class="trend-title">Salinity level</div>
            <canvas id="salTrend"></canvas>
          </div>

          <div class="trend-card-item">
            <div class="trend-title">Pressure level</div>
            <canvas id="pressTrend"></canvas>
          </div>

          <div class="trend-card-item">
            <div class="trend-title">Turbidity level</div>
            <canvas id="turbTrend"></canvas>
          </div>
        </div>
      </div>

      <!-- Recent Records -->
      <div class="card records-card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px">
          <div class="small">RECENT RECORDS</div>
          <div class="small">Rows: <span id="rowCount">0</span></div>
        </div>
        <div class="table-container">
          <table id="recordsTable">
            <thead><tr><th>ts</th><th>pH</th><th>sal</th><th>press</th><th>turb</th><th>leak</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>

  </div>

  <!-- Simulation Page -->
  <div class="wrap page-content" id="simulation-page" style="display:none;">
    <h1>3D SIMULATION VIEW</h1>
    <div class="simulation-container">
      <div class="card sim-full-card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
          <div class="small">LIVE 3D SIMULATION</div>
          <div class="small">Depth: <span id="simDepthNow">--</span> | Speed: <span id="simSpeedNow">--</span>%</div>
        </div>
        <div class="sim-wrap-full">
          <div class="cansat-glow" aria-hidden="true"></div>
          <img src="cansat.jpg" id="simCansatImg" class="cansat-img cansat-anim" alt="CANSAT Underwater">
          <div class="shimmer" aria-hidden="true"></div>
          <div class="bubble-layer" aria-hidden="true">
            <div class="bubble xs b1" style="left:10%; animation-duration:9s;"></div>
            <div class="bubble sm b2" style="left:25%; animation-duration:12s;"></div>
            <div class="bubble lg b3" style="left:42%; animation-duration:8s;"></div>
            <div class="bubble sm b4" style="left:58%; animation-duration:13s;"></div>
            <div class="bubble xs b5" style="left:72%; animation-duration:10s;"></div>
            <div class="bubble sm b6" style="left:86%; animation-duration:7s;"></div>
            <div class="bubble lg b7" style="left:15%; animation-duration:11s;"></div>
            <div class="bubble sm b8" style="left:50%; animation-duration:9s;"></div>
            <div class="bubble xs b9" style="left:80%; animation-duration:14s;"></div>
          </div>
        </div>
      </div>
      <div class="card sim-controls-card">
        <div class="small" style="margin-bottom:10px;">SIMULATION CONTROLS</div>
        <div class="sim-params-grid">
          <div class="sim-param-item">
            <div class="small">Current Depth</div>
            <div class="sim-value" id="simDepth">-- m</div>
          </div>
          <div class="sim-param-item">
            <div class="small">Water Pressure</div>
            <div class="sim-value" id="simPressure">-- kPa</div>
          </div>
          <div class="sim-param-item">
            <div class="small">Temperature</div>
            <div class="sim-value" id="simTemp">-- Â°C</div>
          </div>
          <div class="sim-param-item">
            <div class="small">Visibility</div>
            <div class="sim-value" id="simVisibility">-- m</div>
          </div>
          <div class="sim-param-item">
            <div class="small">Battery Level</div>
            <div class="sim-value" id="simBattery">-- %</div>
          </div>
          <div class="sim-param-item">
            <div class="small">Signal Strength</div>
            <div class="sim-value" id="simSignal">-- %</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Analytics Page -->
  <div class="wrap page-content" id="analytics-page" style="display:none;">
    <h1>DATA ANALYTICS</h1>
    <div class="analytics-container">
      <div class="card analytics-card">
        <div class="small" style="margin-bottom:12px;">STATISTICAL SUMMARY</div>
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-label">Average pH</div>
            <div class="stat-value" id="avgPH">--</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Average Salinity</div>
            <div class="stat-value" id="avgSal">--</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Max Pressure</div>
            <div class="stat-value" id="maxPress">--</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Min Pressure</div>
            <div class="stat-value" id="minPress">--</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Total Records</div>
            <div class="stat-value" id="totalRecords">--</div>
          </div>
          <div class="stat-item">
            <div class="stat-label">Leak Events</div>
            <div class="stat-value" id="leakEvents">--</div>
          </div>
        </div>
      </div>
      <div class="card analytics-chart-card">
        <div class="small" style="margin-bottom:12px;">TREND ANALYSIS</div>
        <div style="position: relative; height: 300px; width: 100%;">
          <canvas id="analyticsChart"></canvas>
        </div>
      </div>
      <div class="card analytics-table-card">
        <div class="small" style="margin-bottom:12px;">DATA EXPORT</div>
        <div class="export-controls">
          <button class="export-btn" onclick="exportData('csv')">Export CSV</button>
          <button class="export-btn" onclick="exportData('json')">Export JSON</button>
          <button class="export-btn" onclick="exportData('pdf')">Export PDF</button>
        </div>
        <div class="data-preview">
          <div class="small" style="margin-top:12px;">Last 20 Records Preview</div>
          <div class="table-container-small">
            <table id="analyticsTable">
              <thead><tr><th>Time</th><th>pH</th><th>Sal</th><th>Press</th><th>Turb</th><th>Leak</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <!-- app script -->
  <script src="appp.js"></script>
  <script>
    // Mobile toggle functionality
    const navToggle = document.getElementById('navToggle');
    const navMenu = document.getElementById('navMenu');
    
    if(navToggle) {
      navToggle.addEventListener('click', () => {
        navMenu.classList.toggle('active');
        navToggle.classList.toggle('active');
      });
    }
    
    // Page navigation functionality
    const navLinks = document.querySelectorAll('.nav-link');
    const pages = {
      'dashboard': document.getElementById('dashboard-page'),
      'simulation': document.getElementById('simulation-page'),
      'analytics': document.getElementById('analytics-page')
    };
    
    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const target = link.getAttribute('href').substring(1);
        
        // Update active nav link
        navLinks.forEach(l => l.classList.remove('active'));
        link.classList.add('active');
        
        // Hide all pages
        Object.values(pages).forEach(page => {
          if(page) page.style.display = 'none';
        });
        
        // Show target page
        if(pages[target]) {
          pages[target].style.display = 'flex';
          
          // If analytics page, ensure chart is initialized
          if(target === 'analytics') {
            setTimeout(() => {
              if(window.initAnalyticsChart) {
                window.initAnalyticsChart();
              }
              if(window.currentRows && window.currentRows.length > 0 && window.updateAnalyticsPage) {
                window.updateAnalyticsPage(window.currentRows);
              }
            }, 100);
          }
        }
        
        // Close mobile menu
        navMenu.classList.remove('active');
        navToggle.classList.remove('active');
      });
    });
    
    // Export data functions - delegate to appp.js
    function exportData(format) {
      if (window.exportDataFromApp) {
        window.exportDataFromApp(format);
      } else {
        alert('Export is not ready yet. Please wait for the data to load.');
      }
    }
  </script>
</body>
</html>
